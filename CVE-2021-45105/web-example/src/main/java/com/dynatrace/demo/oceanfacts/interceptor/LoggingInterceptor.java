package com.dynatrace.demo.oceanfacts.interceptor;

import org.apache.logging.log4j.ThreadContext;
import org.springframework.web.servlet.HandlerInterceptor;

import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;

public class LoggingInterceptor implements HandlerInterceptor {

    @Override
    public boolean preHandle(HttpServletRequest requestServlet, HttpServletResponse responseServlet, Object handler) {
        // get the client IP to the HTTP header
        String clientIp = requestServlet.getHeader("X-Real-Ip");
        if(clientIp == null) {
            // if the IP is not present in the HTTP header use the source IP
            clientIp = requestServlet.getRemoteAddr();
        }
        // set the IP to the ThreadContext to add context to the log entries
        ThreadContext.put("clientIp", clientIp);
        return true;
    }
}
